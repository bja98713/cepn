{% extends 'expertise/layout.html' %}
{% block title %}Liste des bordereaux{% endblock %}
{% block page_icon %}üìÑ{% endblock %}
{% block page_title %}Bordereaux enregistr√©s{% endblock %}
{% block page_subtitle %}Suivez vos envois, contr√¥lez les virements et acc√©dez au d√©tail factures.{% endblock %}

{% block content %}
    <section class="card">
        <table>
            <thead>
                <tr>
                    <th>Num√©ro</th>
                    <th>Date</th>
                    <th>Factures</th>
                    <th>Total (XPF)</th>
                    <th>Virement</th>
                    <th>D√©tail</th>
                    <th>Factures m√©decins</th>
                    <th>Supprimer</th>
                </tr>
            </thead>
            <tbody>
                {% for bordereau in bordereaux %}
                    <tr>
                        <td>{{ bordereau.no_bordereau }}</td>
                        <td>{{ bordereau.date_bordereau|date:"d/m/Y" }}</td>
                        <td>{{ bordereau.nb_factures }}</td>
                        <td>{{ bordereau.total_general }}</td>
                        <td>
                            <div class="actions">
                                <span class="tag {% if bordereau.virement %}tag--success{% else %}tag--danger{% endif %}">
                                    {% if bordereau.virement %}Effectu√©{% else %}Non effectu√©{% endif %}
                                </span>
                                <form method="post" action="{% url 'toggle_virement' bordereau.id %}" class="inline-form">
                                    {% csrf_token %}
                                    <input type="hidden" name="next" value="{{ request.get_full_path }}">
                                    <button type="submit" class="btn btn-secondary btn--small">Basculer</button>
                                </form>
                            </div>
                        </td>
                        <td><a class="btn btn-secondary btn--small" href="{% url 'factures_bordereau' bordereau.no_bordereau %}">Voir</a></td>
                        <td><a class="btn btn-secondary btn--small" href="{% url 'factures_medecins_bordereau' bordereau.no_bordereau %}">Voir</a></td>
                        <td>
                            <form method="post" action="{% url 'supprimer_bordereau' bordereau.id %}" class="inline-form">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-danger btn--small" onclick="return confirm('Supprimer ce bordereau ?')">Supprimer</button>
                            </form>
                        </td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="8" class="empty-state">Aucun bordereau disponible pour le moment.</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </section>
{% endblock %}
