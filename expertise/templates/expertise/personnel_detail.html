{% extends 'expertise/layout.html' %}
{% block title %}Fiche du personnel{% endblock %}
{% block page_icon %}üë§{% endblock %}
{% block page_title %}{{ personnel.prenom }} {{ personnel.nom }}{% endblock %}
{% block page_subtitle %}DN {{ personnel.dn }} ‚Äî {{ personnel.get_statut_pn_display }}{% endblock %}

{% block content %}
    <section class="card">
        <div class="stat-board">
            <div class="stat">
                <span>Date de naissance</span>
                <strong>{{ personnel.date_de_naissance|date:"d/m/Y" }}</strong>
            </div>
            <div class="stat">
                <span>Sexe</span>
                <strong>{{ personnel.get_sexe_display }}</strong>
            </div>
            <div class="stat">
                <span>Compagnie</span>
                <strong>{{ personnel.compagnie.nom }}</strong>
            </div>
            <div class="stat">
                <span>Code IATA</span>
                <strong>{{ personnel.compagnie.iata }}</strong>
            </div>
        </div>
        <div class="actions actions--top">
            <a class="btn" href="{% url 'evenement_add' personnel.dn %}">Cr√©er un nouvel √©v√©nement</a>
            <a class="btn btn-secondary" href="{% url 'personnel_edit' personnel.dn %}">Modifier le profil</a>
            <a class="btn btn-secondary" href="{% url 'personnel_list' %}">Retour √† la liste</a>
        </div>
    </section>

    <section class="card">
        <h2>√âv√©nements associ√©s</h2>
        {% if evenements %}
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Facture</th>
                        <th>Total (XPF)</th>
                        <th>Quote-part</th>
                        <th>Pay√© par le patient</th>
                        <th>Statut</th>
                        <th>Modalit√©</th>
                        <th>Impression</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for event in evenements %}
                        <tr>
                            <td>{{ event.date_evenement|date:"d/m/Y" }}</td>
                            <td>{{ event.no_facture }}</td>
                            <td>{{ event.total }} xpf</td>
                            <td>{{ event.quote_part_patient|yesno:"Oui,Non" }}</td>
                            <td>{{ event.paye_par_patient }} xpf</td>
                            <td>
                                <span class="tag {% if event.paiement %}tag--success{% else %}tag--danger{% endif %}">
                                    {% if event.paiement %}Pay√©{% else %}Non pay√©{% endif %}
                                </span>
                            </td>
                            <td>{{ event.get_modalite_paiement_display }}</td>
                            <td><a href="{% url 'facture' event.pk %}" target="_blank">Imprimer</a></td>
                            <td>
                                <div class="actions">
                                    <a class="btn btn-secondary" href="{% url 'evenement_edit' event.pk %}">Modifier</a>
                                    <a class="btn btn-secondary" href="{% url 'evenement_delete' event.pk %}">Annuler</a>
                                </div>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p class="empty-state">Aucun √©v√©nement enregistr√© pour ce personnel pour le moment.</p>
        {% endif %}
    </section>
{% endblock %}
